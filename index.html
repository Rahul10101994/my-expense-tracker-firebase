<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Simple Expense Tracker</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        /* (Your existing or expanded CSS styles go here) */
    </style>

</head>
<body>

    <header>
        <h1>ðŸ’µ Expense Tracker</h1>
    </header>

    <main>
        <section id="add-expense">
            <h2>Add New Expense</h2>
            <form id="expense-form">
                <input type="text" id="expense-name" placeholder="Item Name (e.g., Groceries)" required>
                <input type="number" id="expense-amount" placeholder="Amount (e.g., 25.50)" step="0.01" required>
                <button type="submit">Add Expense</button>
            </form>
        </section>

        <section id="expense-list-container">
            <h2>Recent Expenses</h2>
            <ul id="expense-list">
                </ul>
        </section>
    </main>

    <script type="module">
        // ------------------------------------------------------------------
        // Part A: Imports and Initialization
        // ------------------------------------------------------------------
        
        // --- 1. Import necessary functions for Firestore and data manipulation ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            query, 
            orderBy, 
            onSnapshot 
        } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
        
        // --- 2. Your Firebase Configuration (Keep your actual keys) ---
        const firebaseConfig = {
            apiKey: "AIzaSyDJ9xWoLd3K_52UNqRiX6xi7gQx0dloIBM",
            authDomain: "expense-tracker-62853.firebaseapp.com",
            projectId: "expense-tracker-62853",
            storageBucket: "expense-tracker-62853.firebasestorage.app",
            messagingSenderId: "375801612134",
            appId: "1:375801612134:web:6cbcc5b3be3eba9b342aa7",
            measurementId: "G-LHLTT1G8N2"
        };

        // --- 3. Initialize Firebase App and Firestore Database ---
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const expensesCollection = collection(db, "expenses"); // Collection reference
        
        console.log("Firebase and Firestore initialized.");

        // --- 4. Get HTML Element References ---
        const expenseForm = document.getElementById('expense-form');
        const expenseList = document.getElementById('expense-list');
        

        // ------------------------------------------------------------------
        // Part B: Saving New Expenses (Form Submission Handler)
        // ------------------------------------------------------------------
        
        expenseForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // Stop page refresh

            const name = document.getElementById('expense-name').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            
            if (!name || isNaN(amount) || amount <= 0) {
                alert('Please enter a valid expense name and amount.');
                return;
            }

            const expenseData = {
                name: name,
                amount: amount,
                timestamp: new Date(), // Use current date/time for sorting
            };

            try {
                // Add the data to the 'expenses' collection
                await addDoc(expensesCollection, expenseData);
                
                // Clear the form
                expenseForm.reset();

            } catch (error) {
                console.error("Error adding document: ", error);
            }
        });


        // ------------------------------------------------------------------
        // Part C: Reading and Listing Expenses (Real-Time Listener)
        // ------------------------------------------------------------------
        
        // Create a query: get data from the 'expenses' collection, ordered by time (newest first)
        const q = query(expensesCollection, orderBy("timestamp", "desc"));

        // Set up the real-time listener
        onSnapshot(q, (querySnapshot) => {
            expenseList.innerHTML = ''; // Clear the list before adding new/updated items

            querySnapshot.forEach((doc) => {
                const expense = doc.data();
                
                // Format the timestamp
                const date = expense.timestamp ? expense.timestamp.toDate().toLocaleDateString() : 'N/A';
                
                // Create and populate the list item
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${expense.name} (${date})</span>
                    <strong>$${expense.amount.toFixed(2)}</strong>
                `;
                
                expenseList.appendChild(li);
            });
        });

    </script>
</body>
</html>